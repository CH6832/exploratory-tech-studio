import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import model.ShoppingCart;

public class UpdateCart {

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
	    int productId = Integer.parseInt(request.getParameter("productId"));
	    int currentQuantity = Integer.parseInt(request.getParameter("currentQuantity"));
	    String action = request.getParameter("action");
	    
	    HttpSession session = request.getSession();
	    ShoppingCart cart = (ShoppingCart) session.getAttribute("cart");
	    if (cart == null) {
	        cart = new ShoppingCart();
	        session.setAttribute("cart", cart);
	    }
	
	    if ("increase".equals(action)) {
	        cart.addItem(productId, 1); // Increase quantity by 1
	    } else if ("decrease".equals(action)) {
	        if (currentQuantity > 1) {
	            cart.addItem(productId, -1); // Decrease quantity by 1
	        } else {
	            cart.removeItem(productId); // Remove item if quantity is 0
	        }
	    }
	    
	    session.setAttribute("cart", cart); // Update session
	    response.sendRedirect("cart.jsp"); // Redirect back to cart
	}
}
